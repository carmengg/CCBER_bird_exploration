---
title: "NCOS_bird_diversity_exploration"
author: "Carmen Galaz-Garc√≠a"
date: "4/27/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(tsibble)


post_survey_data <- read.csv(here('data','COPR_NCOS_Bird_Survey_Data_Aug2017_Aug2019.csv')) %>% 
  clean_names()

```


```{r}
# DATA SELECTION
# Select post-restoration data with desired variables
post_restoration <- post_survey_data %>% 
  mutate(observation_date = lubridate::mdy(observation_date)) %>% # convert to date format
  mutate(location = replace(location, location=="Devereux Slough", "DEVEREUX SLOUGH")) %>% 
  filter( 2016 <= year(observation_date),
          location %in% c("DEVEREUX SLOUGH", "NCOS"))%>%                     
  select(observation_date, 
         location,
         species,
         general_type,
         count) 

# -------------------------------------------------------------------------------
# Count number of individuals per species, observation date and location
# Keep associated general type
species_count <- post_restoration %>% 
  unite("species_and_type", species, general_type, sep="*") %>% 
  count(observation_date,location, species_and_type,
        wt=count) %>% 
  separate(species_and_type, c("species","general_type"), sep="([*])") 

# -------------------------------------------------------------------------------
# Count number of individuals per type, observation date and location
type_count <- post_restoration %>% 
  select(!species) %>% 
  count(observation_date,location,general_type, 
        wt=count)

```


### Counts of individuals per type in NCOS and Deveroux

<br>
<br>

```{r}
ggplot(data= type_count, aes(x=observation_date, y=n)) +
  #geom_line(aes(col=general_type)) 
  geom_line(aes(col=location))+
  facet_wrap(~general_type) +
  theme_light()+
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(title="Comparison of monthly bird counts at Deveroux Slough and NCOS \ngrouping by general type",
       x="observation date",
       y= "number of individuals registered (n)")

```

```{r, include = FALSE}

NCOS_post_restoration <- species_count %>% 
  filter(location == "NCOS") %>% 
  as_tsibble(key = species ,index = observation_date)

DEV_post_restoration <- species_count %>% 
  filter(location %in% c("Devereux Slough","DEVEREUX SLOUGH")) %>% 
  as_tsibble(key = species ,index = observation_date)
```


### Count by species in types with big count differences between NCOS and Deveroux
<br>
<br>

```{r}
insectivores_species <- species_count %>% 
    filter(location == "NCOS") %>% 
  filter(general_type == "Insectivores") %>% 
  mutate(species = case_when( n < 25 ~ "other",
                              n >= 25 ~ species)) 

insectivores_count <- type_count %>% 
  filter(general_type == "Insectivores",
         location %in% c("Devereux Slough","DEVEREUX SLOUGH")) %>% 
  select(!general_type) 

ggplot(insectivores_species) + 
    geom_bar(position="stack", stat="identity", aes(fill=species, y=n, x=observation_date))+
  scale_fill_manual(values = c("#FFDB6D", "#C4961A", "#D16103","azure3", 
                "#C3D7A4", "#52854C", "#4E84C4", "darkorchid"))+
    geom_line(data=insectivores_count, aes(x=observation_date, y=n, col=location))+
    scale_colour_grey()+
  labs(title="Insectivores at NCOS (09/2017-08/2019)",
       y = "number of individuals registered (n)")+
  theme_light()+
  theme( # remove the vertical grid lines
           panel.grid.major.x = element_blank() ,
           panel.grid.minor.x = element_blank() ,
    )

```

```{r}
seed_species <- species_count %>% 
    filter(location == "NCOS") %>% 
  filter(general_type == "Seed & Fruit Eaters") %>% 
  mutate(species = case_when( n < 20 ~ "other",
                              n >= 20 ~ species)) 

seed_count <- type_count %>% 
  filter(general_type == "Seed & Fruit Eaters",
         location %in% c("Devereux Slough","DEVEREUX SLOUGH")) %>% 
  select(!general_type) 


ggplot(seed_species) + 
    geom_bar(position="stack", stat="identity", aes(fill=species, y=n, x=observation_date))+
      scale_fill_manual(values = c("#4E84C4", "#C4961A", "azure3", "#D16103","#C3D7A4"))+
    geom_line(data=seed_count, aes(x=observation_date, y=n, col=location))+
      scale_colour_grey()+
  labs(title="Seed and Fruit Eaters at NCOS (09/2017-08/2019)",
       y = "number of individuals registered (n)")+
  theme_light()+
  theme( # remove the vertical grid lines
           panel.grid.major.x = element_blank() ,
           panel.grid.minor.x = element_blank() ,
    )


```

```{r}

omnivores <- species_count %>% 
    filter(location == "NCOS") %>% 
  filter(general_type == "Omnivores") %>% 
  mutate(species = case_when( n < 10 ~ "other",
                              n >= 10 ~ species)) 


ggplot(omnivores, aes(fill=species, y=n, x=observation_date)) + 
    geom_bar(position="stack", stat="identity")+
  labs(title="Omnivores at NCOS (09/2017-08/2019)",
       y = "number of individuals registered (n)")+
  theme_light()
```

```{r, include=FALSE}

#Checking crow counts in "8/22/2018"

crows_0718 <- post_survey_data %>% 
  filter(location == "NCOS", 
         species == "American Crow",
         observation_date == "8/22/2018")


# crows_0718_count <- species_count %>% 
#   filter(location == "NCOS", 
#          species_and_type == "American Crow*Omnivores",
#          year(observation_date) == 2018,
#          month(observation_date) == 8)
```

