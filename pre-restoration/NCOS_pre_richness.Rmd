---
title: "NCOS/Devereoux Slough 2017-2019 bird survey exploration"
author: "Carmen Galaz-Garc√≠a"
date: "4/15/2021"
output: 
  html_document:
    #toc: true  # make a table of contents
    #toc_float: true  # table of contents as sidebar
    #number_sections: true  
    code_folding: hide  # makes hide/show for code---

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(tsibble)

```



```{r, include=FALSE}
pre_survey_data <- read.csv(here('CCBER_data_and_script_files','survey_data.csv')) %>%
  clean_names()

```

```{r, include = FALSE}
# ---- DATA SELECTION ----
# selecting all CCBER observations for Oceand Meadows Golf Course
# all CCBER observations have 
#    confidence = 2, 
#    present_absent = P or yes
#    num_locations = 1 
#    location2, location3, location 4 = NA

ccber_surveys <- pre_survey_data %>% 
  mutate(date = mdy(date)) %>% 
  filter(source1 == "CCBER") %>% 
  select(unique_id:date,
         location1, 
         total_count,
         bbl_code,
         source1,source2) %>% 
  filter(location1 == "OMG") %>% 
  select(!location1) %>% 
  select(unique_id:bbl_code)

# ----- Adding bird common names from bbl_codes ----

bbl_codes <- read_csv(here("BBL_codes.csv")) %>% 
  clean_names() %>% 
  select(!common_name_aka)

bird_types <- read_csv(here("bird_types.csv")) %>% 
  select(!e_bird_group)

omg_birds <- ccber_surveys %>% 
  left_join(y=bbl_codes,by="bbl_code") %>% 
  left_join(y=bird_types, by = c("common_name" = "species"))


# ---- check which remain with NA name or NA type
no_name <- omg_birds %>% 
  filter(is.na(common_name))

no_type <- omg_birds %>% 
  filter(is.na(general_type))

```


```{r}
# -------- TYPE ABUNDANCE ----------------
# Count number of individuals per type and observation (all NCOS data)
type_count <- omg_birds %>% 
  select(date, total_count, general_type) %>% 
  count(date, general_type, 
        wt=total_count)

# ------- GRAPH ------

ggplot(data= type_count, aes(x=date, y=n)) +
  geom_line()+
  facet_wrap(~general_type) +
  theme_light()+
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(title="Monthly bird counts at NCOS grouping by general type",
       x="observation date",
       y= "number of individuals registered (n)")

```


```{r}
ccber1314 <- pre_survey_data %>% 
  filter(source1=="CCBER", year>= 2013)

```

